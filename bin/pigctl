#!/usr/bin/env bash
user=jtmoulia
host=192.168.50.205
port=8554
repo="https://github.com/jtmoulia/cupie.git"
rev=master


ssh-pig() {
    ssh "${user}@${host}" $@
}

case "$1" in
    cam)
        case "$1" in
            run)
                ssh-pig "/opt/vc/bin/raspivid -o - -w 920 -h 540 -t 9999999 | cvlc -I 'dummy' -v stream:///dev/stdin --sout '#rtp{sdp=rtsp://${user}:${user}@${host}:${port}/}' :demux=h264"
                ssh-pig "pkill -f raspivid"
                ;;
            kill)
                ssh-pig "pkill -f raspivid"
                ;;
            vlc)
                vlc "rtsp://${host}:${port}/"
                ;;
            *)
                echo "Unrecognized command: $1"
                exit 1
                ;;
        esac
        ;;
    temp)
        ssh-pig "if [[ ! -d cupie ]]; then git clone ${repo}; fi && (cd cupie && git pull origin ${rev})"
        ssh-pig "(cd cupie && python -m cupie.therm)"
        ;;
esac
